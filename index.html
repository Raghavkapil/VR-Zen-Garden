<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Zen Garden VR</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <style>
      #overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.92); color: white; z-index: 999;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        font-family: 'Courier New', monospace; text-align: center;
      }
      .btn {
        background: #ff9ff3; color: #2d3436; padding: 18px 40px; font-size: 1.3rem;
        border: none; border-radius: 50px; margin-top: 25px; cursor: pointer; font-weight: bold;
        transition: all 0.3s;
      }
      .btn:hover { transform: scale(1.08); }
    </style>

    <script>
      AFRAME.registerComponent('garden-generator', {
        init: function () {
          const scene = this.el;

          // === 1. Rocks (scattered naturally) ===
          const rockColors = ['#636e72', '#b2bec3', '#2d3436'];
          for (let i = 0; i < 12; i++) {
            let rock = document.createElement('a-dodecahedron');
            let angle = Math.random() * Math.PI * 2;
            let dist = 6 + Math.random() * 12;
            let x = Math.cos(angle) * dist;
            let z = Math.sin(angle) * dist;
            let scale = 0.6 + Math.random() * 1.2;

            rock.setAttribute('position', `${x} ${scale/2} ${z}`);
            rock.setAttribute('radius', scale);
            rock.setAttribute('color', rockColors[Math.floor(Math.random() * rockColors.length)]);
            rock.setAttribute('shadow', 'cast: true; receive: true');
            scene.appendChild(rock);
          }

          // === 2. Trees - Now perfectly surrounding the player in a circle ===
          const treeColors = ['#ff9ff3', '#fd79a8', '#e84393'];
          for (let i = 0; i < 16; i++) {
            let tree = document.createElement('a-entity');
            let angle = (i / 16) * Math.PI * 2;
            let distance = 10 + Math.random() * 8; // 10–18 meters away → perfect zen circle
            let x = Math.cos(angle) * distance;
            let z = Math.sin(angle) * distance;

            tree.setAttribute('position', `${x} 0 ${z}`);

            // Trunk
            let trunk = document.createElement('a-cylinder');
            trunk.setAttribute('radius', 0.18);
            trunk.setAttribute('height', 1.8);
            trunk.setAttribute('color', '#8d6e63');
            trunk.setAttribute('position', '0 0.9 0');
            trunk.setAttribute('shadow', 'cast: true');
            tree.appendChild(trunk);

            // Leaves (NO rotation anymore)
            let leaves = document.createElement('a-icosahedron');
            leaves.setAttribute('radius', 1.3 + Math.random() * 0.7);
            leaves.setAttribute('color', treeColors[i % treeColors.length]);
            leaves.setAttribute('position', '0 2.4 0');
            leaves.setAttribute('shadow', 'cast: true; receive: true');
            tree.appendChild(leaves);

            scene.appendChild(tree);
          }

          // === 3. Fireflies ===
          for (let i = 0; i < 20; i++) {
            let fly = document.createElement('a-sphere');
            let angle = Math.random() * Math.PI * 2;
            let dist = 3 + Math.random() * 8;
            let x = Math.cos(angle) * dist;
            let z = Math.sin(angle) * dist;
            let y = 1.5 + Math.random() * 2.5;

            fly.setAttribute('position', `${x} ${y} ${z}`);
            fly.setAttribute('radius', 0.05);
            fly.setAttribute('color', '#fffaa8');
            fly.setAttribute('material', 'emissive: #fffaa8; emissiveIntensity: 1');
            fly.setAttribute('animation', 'property: position; to: ' + x + ' ' + (y + 0.8) + ' ' + z +
              '; dir: alternate; dur: ' + (2000 + Math.random() * 3000) + '; loop: true; easing: easeInOutSine');
            scene.appendChild(fly);
          }

          // === 4. Day Birds ===
          for (let i = 0; i < 5; i++) {
            let pivot = document.createElement('a-entity');
            pivot.classList.add('day-birds');
            pivot.setAttribute('rotation', '0 ' + Math.random() * 360 + ' 0');
            pivot.setAttribute('animation', 'property: rotation; to: 0 720 0; dur: 50000; loop: true; easing: linear');

            let bird = document.createElement('a-entity');
            let r = 12 + Math.random() * 10;
            let h = 9 + Math.random() * 6;
            bird.setAttribute('position', `${r} ${h} 0`);

            let wingL = document.createElement('a-triangle');
            wingL.setAttribute('vertex-a', '0 0 0'); wingL.setAttribute('vertex-b', '0.35 0 -0.15'); wingL.setAttribute('vertex-c', '0.18 0 0.45');
            wingL.setAttribute('color', '#f8f9fa'); wingL.setAttribute('side', 'double');
            wingL.setAttribute('animation', 'property: rotation; to: 0 0 60; dir: alternate; dur: 350; loop: true');

            let wingR = document.createElement('a-triangle');
            wingR.setAttribute('vertex-a', '0 0 0'); wingR.setAttribute('vertex-b', '-0.35 0 -0.15'); wingR.setAttribute('vertex-c', '-0.18 0 0.45');
            wingR.setAttribute('color', '#f8f9fa'); wingR.setAttribute('side', 'double');
            wingR.setAttribute('animation', 'property: rotation; to: 0 0 -60; dir: alternate; dur: 350; loop: true');

            bird.appendChild(wingL);
            bird.appendChild(wingR);
            bird.setAttribute('animation__bob', 'property: position; dir: alternate; to: ' + r + ' ' + (h + 1) + ' 0; dur: 2500; loop: true; easing: easeInOutSine');
            pivot.appendChild(bird);
            scene.appendChild(pivot);
          }

          // === 5. Stars - Now perfectly visible & beautiful ===
          for (let i = 0; i < 250; i++) {
            let star = document.createElement('a-sphere');
            let theta = Math.random() * Math.PI * 2;
            let phi = Math.acos(2 * Math.random() - 1);
            let radius = 49;

            let x = radius * Math.sin(phi) * Math.cos(theta);
            let y = radius * Math.sin(phi) * Math.sin(theta) + 30;
            let z = radius * Math.cos(phi);

            star.setAttribute('position', `${x} ${y} ${z}`);
            star.setAttribute('radius', 0.18 + Math.random() * 0.15);
            star.setAttribute('color', '#ffffff');
            star.setAttribute('material', 'emissive: #ffffff; emissiveIntensity: 0; opacity: 0; metalness: 0; roughness: 0');
            star.classList.add('night-star');

            let twinkleDur = 3000 + Math.random() * 4000;
            let delay = Math.random() * 5000;

            star.setAttribute('animation__opacity', {
              property: 'material.opacity',
              from: 0.4, to: 1,
              dur: twinkleDur,
              dir: 'alternate',
              loop: true,
              delay: delay,
              easing: 'easeInOutSine'
            });
            star.setAttribute('animation__glow', {
              property: 'material.emissiveIntensity',
              from: 0.6, to: 2.2,
              dur: twinkleDur,
              dir: 'alternate',
              loop: true,
              delay: delay,
              easing: 'easeInOutSine'
            });

            scene.appendChild(star);
          }
        }
      });

      // === PERFECT Day/Night Toggle (Works Forever) ===
      AFRAME.registerComponent('atmosphere-control', {
        init: function () {
          this.isDay = true;
          this.sky = document.querySelector('a-sky');
          this.light = document.querySelector('#mainLight');
          this.sunMoon = this.el;
          this.sceneEl = document.querySelector('a-scene');

          this.el.addEventListener('click', () => this.toggle());
        },

        toggle: function () {
          const birds = document.querySelectorAll('.day-birds');
          const stars = document.querySelectorAll('.night-star');

          if (this.isDay) {
            // → NIGHT
            this.sky.setAttribute('color', '#0a1428');
            this.light.setAttribute('intensity', 0.03);
            this.sceneEl.setAttribute('fog', 'color: #0a1428; density: 0.05');

            birds.forEach(b => b.setAttribute('visible', false));
            stars.forEach(s => {
              s.setAttribute('material', 'opacity', 1);
              s.setAttribute('material', 'emissiveIntensity', 1.5);
            });

            // Moon
            this.sunMoon.setAttribute('color', '#f0f4f8');
            this.sunMoon.setAttribute('material', 'emissive: #dde4ff; emissiveIntensity: 0.9');
            this.sunMoon.setAttribute('light', 'type: point; intensity: 2.2; distance: 50');

          } else {
            // → DAY
            this.sky.setAttribute('color', '#81ecec');
            this.light.setAttribute('intensity', 1);
            this.sceneEl.setAttribute('fog', 'color: #e0f7fa; density: 0.04');

            birds.forEach(b => b.setAttribute('visible', true));
            stars.forEach(s => {
              s.setAttribute('material', 'opacity', 0);
              s.setAttribute('material', 'emissiveIntensity', 0);
            });

            // Sun
            this.sunMoon.setAttribute('color', '#ff7675');
            this.sunMoon.setAttribute('material', 'shader: flat');
            this.sunMoon.removeAttribute('light');
          }
          this.isDay = !this.isDay;
        }
      });
    </script>
  </head>
  <body>

    <div id="overlay">
      <h1>ZEN GARDEN VR</h1>
      <p>Procedural Peaceful World</p>
      <p>• Trees surround you in harmony</p>
      <p>• Birds fly during the day</p>
      <p>• Stars twinkle beautifully at night</p>
      <p>Stare or click the Sun/Moon to change time</p>
      <button class="btn" onclick="document.querySelector('#overlay').style.display='none'">ENTER ZEN</button>
    </div>

    <a-scene garden-generator fog="type: exponential; color: #e0f7fa; density: 0.04" shadow="type: pcfsoft">
      <a-sky color="#81ecec"></a-sky>
      <a-plane rotation="-90 0 0" width="120" height="120" color="#f5f5dc" shadow="receive: true"></a-plane>

      <a-light type="ambient" intensity="0.5" color="#ffffff"></a-light>
      <a-light id="mainLight" type="directional" intensity="1" position="8 20 10" castShadow="true"></a-light>

      <a-sphere id="sunmoon" class="clickable" atmosphere-control
                position="0 10 -20" radius="2.2" color="#ff7675" shader="flat"></a-sphere>

      <a-entity position="0 1.6 0">
        <a-camera>
          <a-cursor color="white" fuse="true" raycaster="objects: .clickable"></a-cursor>
        </a-camera>
      </a-entity>
    </a-scene>
  </body>
</html>